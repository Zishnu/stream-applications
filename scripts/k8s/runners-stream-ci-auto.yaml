apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: runners-stream-ci
spec:
  template:
    spec:
      priorityClassName: high-priority
      image: 'summerwind/actions-runner:latest'
      dockerdWithinRunnerContainer: true
      imagePullPolicy: IfNotPresent
      imagePullSecrets:
        - name: stream-metadata-default
      repository: spring-cloud/stream-applications
      githubAPICredentialsFrom:
        secretRef:
          name: controller-manager-secret
      resources:
        requests:
          cpu: "1500m"
          memory: "2Gi"
      labels:
        - stream-ci
---
apiVersion: actions.summerwind.dev/v1alpha1
kind: HorizontalRunnerAutoscaler
metadata:
  name: runners-stream-ci-scaling
spec:
  githubAPICredentialsFrom:
    secretRef:
      name: controller-manager-secret
  minReplicas: 2
  maxReplicas: 2
  scaleTargetRef:
    kind: RunnerDeployment
    name: runners-stream-ci
  scaleUpTriggers:
    - githubEvent:
        workflowJob: {}
      duration: "30m"
